{"ast":null,"code":"import \"vant/es/uploader/style\";\nimport _Uploader from \"vant/es/uploader\";\nimport \"vant/es/rate/style\";\nimport _Rate from \"vant/es/rate\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/nav-bar/style\";\nimport _NavBar from \"vant/es/nav-bar\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { orderListGoods, orderEvaluationAdd } from '@/API/user';\nimport { priceFormat } from '@/utils/utis';\nimport { uploadimg } from \"@/API/commodity\";\nexport default {\n  name: 'OrderEvaluate',\n  components: {\n    [_NavBar.name]: _NavBar,\n    [_Toast.name]: _Toast,\n    [_Rate.name]: _Rate,\n    [_Uploader.name]: _Uploader\n  },\n  data() {\n    return {\n      mainColor: process.env.VUE_APP_MAIN_COLOR,\n      fileList: [],\n      cancelShow: false,\n      remindShow: false,\n      currentData: null,\n      orderId: null,\n      goodsData: []\n    };\n  },\n  mounted() {\n    this.$nextTick(() => {\n      const {\n        id\n      } = this.$route.query;\n      if (id) {\n        this.orderId = id;\n        this.getOrderGoods();\n      } else {\n        _Toast(this.$t('订单号不存在'));\n        setTimeout(() => {\n          this.$router.back();\n        }, 1500);\n      }\n    });\n  },\n  methods: {\n    afterRead(file, {\n      name\n    }) {\n      // if('[object Array]' == Object.prototype.toString.call(file)) {\n\n      // }\n      let index = this.goodsData[name].fileList.length; // 图片的索引\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('上传中'),\n        forbidClick: true\n      });\n      let formData = new FormData(); //通过formdata上传\n      formData.append('file', file.file);\n      formData.append('moduleName', 'selle');\n      let goodsId = '';\n      uploadimg(formData).then(data => {\n        console.log('图片上传成功', data);\n        // this.ruleForm.idimg_2 = data\n        this.goodsData[name][`imgUrl${index}`] = data; //待提交图片的索引\n      }).catch(error => {\n        this.fileList = [];\n        // Toast.fail(this.$t('上传失败'));\n        this.$notify(this.$t('上传失败'));\n      }).finally(() => {\n        _Toast.clear();\n      });\n    },\n    priceFormat(num) {\n      return priceFormat(num);\n    },\n    getOrderGoods() {\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('请求中'),\n        forbidClick: true\n      });\n      orderListGoods({\n        orderId: this.orderId\n      }).then(res => {\n        const data = res.pageList || [];\n        data.forEach(item => {\n          item.rating = 5;\n          item.content = '';\n        });\n        this.goodsData = data;\n        _Toast.clear();\n      }).catch(() => {\n        _Toast.clear();\n      });\n    },\n    async submitHandle() {\n      const dataArr = this.goodsData.map(item => {\n        const {\n          rating,\n          content,\n          goodsId\n        } = item;\n        let evaluationType = '1';\n        if (rating < 2) {\n          evaluationType = '3';\n        } else if (rating < 4) {\n          evaluationType = '2';\n        } else {\n          evaluationType = '1';\n        }\n        let obj = {\n          orderId: this.orderId,\n          sellerGoodsId: goodsId,\n          rating,\n          content,\n          evaluationType\n        };\n        Object.keys(item).forEach(key => {\n          if (key.indexOf('imgUrl') !== -1) {\n            obj[key] = item[key];\n          }\n        });\n        return obj;\n      });\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('提交中'),\n        forbidClick: true\n      });\n      for (let i = 0; i < dataArr.length; i++) {\n        await orderEvaluationAdd(dataArr[i]);\n      }\n      _Toast.success(this.$t('成功'));\n      setTimeout(() => {\n        this.$router.back();\n      }, 1000);\n    }\n  }\n};","map":{"version":3,"names":["orderListGoods","orderEvaluationAdd","priceFormat","uploadimg","name","components","_NavBar","_Toast","_Rate","_Uploader","data","mainColor","process","env","VUE_APP_MAIN_COLOR","fileList","cancelShow","remindShow","currentData","orderId","goodsData","mounted","$nextTick","id","$route","query","getOrderGoods","$t","setTimeout","$router","back","methods","afterRead","file","index","length","loading","duration","message","forbidClick","formData","FormData","append","goodsId","then","console","log","catch","error","$notify","finally","clear","num","res","pageList","forEach","item","rating","content","submitHandle","dataArr","map","evaluationType","obj","sellerGoodsId","Object","keys","key","indexOf","i","success"],"sources":["src/page/Order/Evaluate/index.vue"],"sourcesContent":["<template>\r\n    <div class=\"page-content\">\r\n        <van-nav-bar safe-area-inset-top fixed :title=\"$t('评价')\" left-arrow @click-left=\"() => $router.back()\" />\r\n        <div style=\"width: 100%; height: 46px;\" />\r\n\r\n        <div v-if=\"goodsData.length\" class=\"evaluate-content\">\r\n            <div v-for=\"(item, index) in goodsData\" :key=\"index\" class=\"item\">\r\n                <div class=\"goods-info\">\r\n                    <div class=\"poster\">\r\n                        <img :src=\"item.goodsIcon\" alt=\"\">\r\n                    </div>\r\n                    <div class=\"info\">\r\n                        <p class=\"name\">{{ item.goodsName?.length > 27 ? (item.goodsName.slice(0, 27) + '...') :\r\n                            item.goodsName }}</p>\r\n                        <p class=\"price\">$ {{ priceFormat(item.goodsReal) }}</p>\r\n                        <van-rate class=\"rate-wrap\" v-model=\"item.rating\" :size=\"15\" ::color=\"mainColor\" void-icon=\"star\"\r\n                            void-color=\"#D9D9D9\" />\r\n                    </div>\r\n                </div>\r\n                <el-input type=\"textarea\" :autosize=\"{ minRows: 3, maxRows: 4 }\" :placeholder=\"$t('请输入评价信息')\" resize=\"none\"\r\n                    v-model=\"item.content\" maxlength=\"1000\" show-word-limit />\r\n                <div class=\"evaluate-title\">{{ $t('评价晒图') }}</div>\r\n                <van-uploader :after-read=\"afterRead\" v-model=\"item.fileList\" :name=\"index\" :max-count=\"9\" accept=\".png,.jpg,.jpeg\" />\r\n            </div>\r\n\r\n            <div class=\"submit-btn\" @click=\"submitHandle\">{{ $t('提交评论') }}</div>\r\n\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { NavBar, Toast, Rate, Uploader } from 'vant'\r\n\r\nimport {\r\n    orderListGoods,\r\n    orderEvaluationAdd\r\n} from '@/API/user'\r\n\r\nimport {\r\n    priceFormat\r\n} from '@/utils/utis'\r\nimport { uploadimg } from \"@/API/commodity\";\r\nexport default {\r\n    name: 'OrderEvaluate',\r\n    components: {\r\n        [NavBar.name]: NavBar,\r\n        [Toast.name]: Toast,\r\n        [Rate.name]: Rate,\r\n        [Uploader.name]: Uploader\r\n    },\r\n    data() {\r\n        return {\r\n            mainColor: process.env.VUE_APP_MAIN_COLOR,\r\n            fileList: [],\r\n            cancelShow: false,\r\n            remindShow: false,\r\n            currentData: null,\r\n            orderId: null,\r\n            goodsData: []\r\n        }\r\n    },\r\n    mounted() {\r\n        this.$nextTick(() => {\r\n            const { id } = this.$route.query\r\n            if (id) {\r\n                this.orderId = id\r\n                this.getOrderGoods()\r\n            } else {\r\n                Toast(this.$t('订单号不存在'))\r\n                setTimeout(() => {\r\n                    this.$router.back()\r\n                }, 1500);\r\n            }\r\n        })\r\n    },\r\n    methods: {\r\n        afterRead(file, { name }) {\r\n            // if('[object Array]' == Object.prototype.toString.call(file)) {\r\n                \r\n            // }\r\n            let index = this.goodsData[name].fileList.length // 图片的索引\r\n            Toast.loading({\r\n                duration: 0,\r\n                message: this.$t('上传中'),\r\n                forbidClick: true,\r\n            })\r\n            let formData = new FormData();//通过formdata上传\r\n            formData.append('file', file.file)\r\n            formData.append('moduleName', 'selle')\r\n            let goodsId = ''\r\n            uploadimg(formData).then((data) => {\r\n                console.log('图片上传成功', data)\r\n                // this.ruleForm.idimg_2 = data\r\n                this.goodsData[name][`imgUrl${index}`] = data //待提交图片的索引\r\n            }).catch((error) => {\r\n                this.fileList = [];\r\n                // Toast.fail(this.$t('上传失败'));\r\n                this.$notify(this.$t('上传失败'))\r\n            }).finally(() => {\r\n                Toast.clear()\r\n            })\r\n        },\r\n        priceFormat(num) {\r\n            return priceFormat(num)\r\n        },\r\n        getOrderGoods() {\r\n            Toast.loading({\r\n                duration: 0,\r\n                message: this.$t('请求中'),\r\n                forbidClick: true\r\n            })\r\n\r\n            orderListGoods({\r\n                orderId: this.orderId\r\n            }).then(res => {\r\n                const data = res.pageList || []\r\n                data.forEach(item => {\r\n                    item.rating = 5\r\n                    item.content = ''\r\n                })\r\n                this.goodsData = data\r\n                Toast.clear()\r\n            }).catch(() => {\r\n                Toast.clear()\r\n            })\r\n        },\r\n\r\n        async submitHandle() {\r\n            const dataArr = this.goodsData.map(item => {\r\n                const { rating, content, goodsId } = item\r\n                let evaluationType = '1'\r\n                if (rating < 2) {\r\n                    evaluationType = '3'\r\n                } else if (rating < 4) {\r\n                    evaluationType = '2'\r\n                } else {\r\n                    evaluationType = '1'\r\n                }\r\n                let obj = {\r\n                    orderId: this.orderId,\r\n                    sellerGoodsId: goodsId,\r\n                    rating,\r\n                    content,\r\n                    evaluationType\r\n                }\r\n                Object.keys(item).forEach(key => {\r\n                    if (key.indexOf('imgUrl') !== -1) {\r\n                        obj[key] = item[key]\r\n                    }\r\n                })\r\n                return obj\r\n            })\r\n            Toast.loading({\r\n                duration: 0,\r\n                message: this.$t('提交中'),\r\n                forbidClick: true,\r\n            })\r\n\r\n            for (let i = 0; i < dataArr.length; i++) {\r\n                await orderEvaluationAdd(dataArr[i])\r\n            }\r\n\r\n            Toast.success(this.$t('成功'))\r\n            setTimeout(() => {\r\n                this.$router.back()\r\n            }, 1000)\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.evaluate-title {\r\n    font-size: 12px;\r\n    color: #999999;\r\n    margin-top: 18px;\r\n    margin-bottom: 10px;\r\n}\r\n\r\n.page-content {\r\n    min-height: 100vh;\r\n    background-color: #F5F5F7;\r\n\r\n    * {\r\n        box-sizing: border-box;\r\n    }\r\n\r\n    /deep/ .el-textarea {\r\n        textarea:focus {\r\n            border-color: var(--main-color) !important;\r\n        }\r\n    }\r\n\r\n    .evaluate-content {\r\n        padding: 0 15px;\r\n        padding-bottom: 40px;\r\n\r\n        >.item {\r\n            padding: 18px 24px;\r\n            background-color: #fff;\r\n            margin-top: 10px;\r\n\r\n            >.goods-info {\r\n                display: flex;\r\n                padding-bottom: 15px;\r\n\r\n                >.poster {\r\n                    width: 78px;\r\n                    height: 78px;\r\n                    overflow: hidden;\r\n                    display: flex;\r\n                    align-items: center;\r\n                    justify-content: center;\r\n\r\n                    >img {\r\n                        width: 100%;\r\n                        height: auto;\r\n                    }\r\n                }\r\n\r\n                >.info {\r\n                    padding-left: 15px;\r\n                    flex: 1;\r\n\r\n                    >.name {\r\n                        overflow: hidden;\r\n                        text-overflow: ellipsis;\r\n                        display: -webkit-box;\r\n                        -webkit-box-orient: vertical;\r\n                        -moz-box-orient: vertical;\r\n                        box-orient: vertical;\r\n                        -webkit-line-clamp: 2;\r\n                        line-clamp: 2;\r\n                        font-size: 14px;\r\n                        color: #000;\r\n                    }\r\n\r\n                    >.price {\r\n                        display: flex;\r\n                        align-items: center;\r\n                        margin-top: 10px;\r\n                        \r\n                        color: var(--main-color);\r\n                        font-size: 16px;\r\n                        font-weight: bold;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        >.submit-btn {\r\n            margin-top: 40px;\r\n            width: 100%;\r\n            height: 44px;\r\n            background: var(--main-color);\r\n            border-radius: 4px;\r\n            font-style: normal;\r\n            font-weight: 400;\r\n            font-size: 16px;\r\n            line-height: 44px;\r\n            text-align: center;\r\n            color: #FFFFFF;\r\n        }\r\n    }\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}