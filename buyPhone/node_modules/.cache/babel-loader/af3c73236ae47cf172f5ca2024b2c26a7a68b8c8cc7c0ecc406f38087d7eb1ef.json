{"ast":null,"code":"import \"vant/es/image-preview/style\";\nimport _ImagePreview from \"vant/es/image-preview\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/nav-bar/style\";\nimport _NavBar from \"vant/es/nav-bar\";\nimport { rechargeBlockchainDetails } from \"@/API/user\";\nimport { getImgUrl, priceFormat } from '@/utils/utis';\nimport QRCode from 'qrcode';\nexport default {\n  name: 'rechargeRecordDetails',\n  components: {\n    [_NavBar.name]: _NavBar,\n    [_Toast.name]: _Toast,\n    [_ImagePreview.Component.name]: _ImagePreview.Component\n  },\n  data() {\n    return {\n      itemName: process.env.VUE_APP_ITEM_NAME,\n      pageDone: false,\n      orderNo: null,\n      dataInfo: null,\n      previewShow: false,\n      previewImages: [],\n      codeImgUrl: '',\n      priceFormat\n    };\n  },\n  mounted() {\n    this.$nextTick(() => {\n      const {\n        order_no,\n        failure_msg\n      } = this.$route.query;\n      if (order_no) {\n        this.orderNo = order_no;\n        this.failureMsg = failure_msg;\n        this.getDataInfo();\n      } else {\n        _Toast(this.$t('订单号不存在'));\n      }\n    });\n  },\n  methods: {\n    onClickLeft() {\n      this.$router.go(-1);\n    },\n    copyData(ea) {\n      this.$copyText(ea).then(() => {\n        _Toast(this.$t('复制成功'));\n      }, () => {\n        _Toast(this.$t('复制失败'));\n      });\n    },\n    getDataInfo() {\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('请求中')\n      });\n      rechargeBlockchainDetails({\n        order_no: this.orderNo\n      }).then(res => {\n        res.stateStr = '';\n        res.className = '';\n        if (res.state === 0) {\n          res.stateStr = this.$t('处理中');\n        }\n        if (res.state === 1) {\n          res.className = 'success';\n          res.stateStr = this.$t('成功');\n        }\n        if (res.state === 2) {\n          res.className = 'fail';\n          res.stateStr = this.$t('失败');\n        }\n        if (res.img) {\n          this.previewImages = [res.img];\n        }\n        this.dataInfo = res;\n        this.pageDone = true;\n        _Toast.clear();\n        this.$nextTick(() => {\n          this.createCodeImg(res.from);\n        });\n      }).catch(err => {\n        // Toast(err.msg)\n        _Toast.clear();\n      });\n    },\n    // 生成二维码\n    createCodeImg(txt) {\n      const that = this;\n      const canvas = document.getElementById('canvas');\n      QRCode.toCanvas(canvas, txt, {\n        width: 124,\n        height: 124,\n        margin: 0\n      }, function (error) {\n        if (error) {\n          // console.error(error)\n        } else {\n          that.codeImgUrl = canvas.toDataURL('image/png');\n        }\n      });\n    },\n    saveCodeImg() {\n      let myCanvas = document.getElementsByTagName('canvas');\n      this.imgUrl = myCanvas[0].toDataURL('image/png');\n      this.getUrlBase64(this.imgUrl).then(base64 => {\n        let link = document.createElement('a');\n        link.href = base64;\n        link.download = 'qrCode.png';\n        link.click();\n      });\n    },\n    getUrlBase64(url) {\n      return new Promise(resolve => {\n        let canvas = document.createElement('canvas');\n        let ctx = canvas.getContext('2d');\n        let img = new Image();\n        img.crossOrigin = 'Anonymous'; //允许跨域\n        img.src = url;\n        img.onload = function () {\n          canvas.height = 300;\n          canvas.width = 300;\n          ctx.drawImage(img, 0, 0, 300, 300);\n          let dataURL = canvas.toDataURL('image/png');\n          canvas = null;\n          resolve(dataURL);\n        };\n      });\n    },\n    getImgUrlHandle(path) {\n      console.log(`path ::->`, path);\n      return getImgUrl(path);\n    },\n    toPay(path) {\n      window.open(path);\n    }\n  }\n};","map":{"version":3,"names":["rechargeBlockchainDetails","getImgUrl","priceFormat","QRCode","name","components","_NavBar","_Toast","_ImagePreview","Component","data","itemName","process","env","VUE_APP_ITEM_NAME","pageDone","orderNo","dataInfo","previewShow","previewImages","codeImgUrl","mounted","$nextTick","order_no","failure_msg","$route","query","failureMsg","getDataInfo","$t","methods","onClickLeft","$router","go","copyData","ea","$copyText","then","loading","duration","message","res","stateStr","className","state","img","clear","createCodeImg","from","catch","err","txt","that","canvas","document","getElementById","toCanvas","width","height","margin","error","toDataURL","saveCodeImg","myCanvas","getElementsByTagName","imgUrl","getUrlBase64","base64","link","createElement","href","download","click","url","Promise","resolve","ctx","getContext","Image","crossOrigin","src","onload","drawImage","dataURL","getImgUrlHandle","path","console","log","toPay","window","open"],"sources":["src/page/recharge/RecordDetails/index.vue"],"sourcesContent":["<template>\r\n    <div class=\"page-content\">\r\n        <van-image-preview v-if=\"previewImages.length\" v-model=\"previewShow\" :images=\"previewImages\"></van-image-preview>\r\n\r\n        <van-nav-bar safe-area-inset-top fixed :title=\"$t('充值详情')\" left-arrow @click-left=\"onClickLeft\" />\r\n        <div style=\"width: 100%;\" class=\"h46\"></div>\r\n\r\n        <div v-if=\"pageDone && dataInfo\" class=\"info-content\">\r\n            <div class=\"order-info-content\">\r\n                <div class=\"item\">\r\n                    <p>{{ $t('订单号') }}：</p>\r\n                    <div class=\"copy\" @click=\"copyData(dataInfo.order_no)\">\r\n                        <span style=\"text-align: end;\">{{ dataInfo.order_no }}</span>\r\n                        <img src=\"@/assets/image/me/fuzhi1.png\" />\r\n                    </div>\r\n                </div>\r\n                <div class=\"item\">\r\n                    <p>{{ $t('创建时间') }}：</p>\r\n                    <div>{{ dataInfo.create_time }}</div>\r\n                </div>\r\n                <div class=\"item\">\r\n                    <p>{{ $t('充值数量') }}：</p>\r\n                    <div class=\"money\">{{ dataInfo.volume > 1 ? priceFormat(dataInfo.volume) : dataInfo.volume }} {{\r\n                        dataInfo.coin }}</div>\r\n                </div>\r\n                <div class=\"item\">\r\n                    <p>{{ $t('实际到账') }}：</p>\r\n                    <div class=\"money\" v-if=\"priceFormat(dataInfo.amount)\">{{ priceFormat(dataInfo.amount) }} USDT</div>\r\n                    <div class=\"money\" v-else>--</div>\r\n                </div>\r\n\r\n                <div class=\"item\">\r\n                    <p>{{ $t('订单状态') }}：</p>\r\n                    <div class=\"money\" :class=\"dataInfo.className\">{{ dataInfo.stateStr }}</div>\r\n                </div>\r\n                <div class=\"item\" v-if=\"dataInfo.state == 2\">\r\n                    <p>{{ $t('失败原因') }}：</p>\r\n                    <div class=\"money\" :class=\"dataInfo.className\">{{ dataInfo.failureMsg || '--' }}</div>\r\n                </div>\r\n                <div class=\"item\" v-if=\"dataInfo.coin_blockchain\">\r\n                    <p>{{ $t('币种协议') }}：</p>\r\n                    <div>{{ dataInfo.coin_blockchain }}</div>\r\n                </div>\r\n                <div class=\"item no-border\" v-if=\"dataInfo.channel_address\">\r\n                    <p>{{ $t('收款地址') }}：</p>\r\n                    <div class=\"copy\" @click=\"copyData(dataInfo.channel_address)\">\r\n                        <span>{{ dataInfo.channel_address }}</span>\r\n                        <img src=\"@/assets/image/me/fuzhi1.png\" />\r\n                    </div>\r\n                </div>\r\n                <div class=\"item code-img\" v-if=\"codeImgUrl\">\r\n                    <div class=\"code-img-content\">\r\n                        <canvas id=\"canvas\" style=\"display:none\"></canvas>\r\n                        <img :src=\"codeImgUrl\" class=\"canvas\" />\r\n                    </div>\r\n                    <div class=\"btn\">\r\n                        <div @click=\"saveCodeImg\">{{ $t('保存二维码') }}</div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"item center\" v-if=\"dataInfo.img\">\r\n                    <p>{{ $t('支付凭证') }}：</p>\r\n                    <div class=\"copy\">\r\n                        <div class=\"img-content\" @click=\"previewShow = true\">\r\n                            <img :src=\"dataInfo.img\" alt=\"\">\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <!-- Shop2u 未处理跳转支付按钮 -->\r\n            <van-button block type=\"primary\" v-if=\"itemName == 'Shop2u' && dataInfo.state == 0 && dataInfo.payUrl\"\r\n                class=\"pay_btn\" @click=\"toPay(dataInfo.payUrl)\">\r\n                {{ $t('立即支付') }}\r\n            </van-button>\r\n        </div>\r\n    </div>\r\n</template>\r\n<script>\r\nimport { NavBar, Toast, ImagePreview } from 'vant';\r\nimport { rechargeBlockchainDetails } from \"@/API/user\";\r\nimport { getImgUrl, priceFormat } from '@/utils/utis'\r\nimport QRCode from 'qrcode'\r\nexport default {\r\n    name: 'rechargeRecordDetails',\r\n    components: {\r\n        [NavBar.name]: NavBar,\r\n        [Toast.name]: Toast,\r\n        [ImagePreview.Component.name]: ImagePreview.Component\r\n    },\r\n    data() {\r\n        return {\r\n            itemName: process.env.VUE_APP_ITEM_NAME,\r\n            pageDone: false,\r\n            orderNo: null,\r\n            dataInfo: null,\r\n            previewShow: false,\r\n            previewImages: [],\r\n            codeImgUrl: '',\r\n            priceFormat,\r\n        }\r\n    },\r\n    mounted() {\r\n        this.$nextTick(() => {\r\n            const { order_no, failure_msg } = this.$route.query\r\n            if (order_no) {\r\n                this.orderNo = order_no\r\n                this.failureMsg = failure_msg\r\n                this.getDataInfo()\r\n            } else {\r\n                Toast(this.$t('订单号不存在'));\r\n            }\r\n        })\r\n    },\r\n    methods: {\r\n        onClickLeft() {\r\n            this.$router.go(-1)\r\n        },\r\n        copyData(ea) {\r\n            this.$copyText(ea).then(() => {\r\n                Toast(this.$t('复制成功'))\r\n            }, () => {\r\n                Toast(this.$t('复制失败'))\r\n            })\r\n        },\r\n        getDataInfo() {\r\n            Toast.loading({\r\n                duration: 0,\r\n                message: this.$t('请求中')\r\n            })\r\n            rechargeBlockchainDetails({ order_no: this.orderNo }).then(res => {\r\n                res.stateStr = ''\r\n                res.className = ''\r\n                if (res.state === 0) {\r\n                    res.stateStr = this.$t('处理中')\r\n                }\r\n                if (res.state === 1) {\r\n                    res.className = 'success'\r\n                    res.stateStr = this.$t('成功')\r\n                }\r\n                if (res.state === 2) {\r\n                    res.className = 'fail'\r\n                    res.stateStr = this.$t('失败')\r\n                }\r\n                if (res.img) {\r\n                    this.previewImages = [res.img]\r\n                }\r\n                this.dataInfo = res\r\n                this.pageDone = true\r\n                Toast.clear()\r\n                this.$nextTick(() => {\r\n                    this.createCodeImg(res.from)\r\n                })\r\n            }).catch(err => {\r\n                // Toast(err.msg)\r\n                Toast.clear()\r\n            })\r\n        },\r\n        // 生成二维码\r\n        createCodeImg(txt) {\r\n            const that = this\r\n            const canvas = document.getElementById('canvas')\r\n            QRCode.toCanvas(canvas, txt,\r\n                {\r\n                    width: 124,\r\n                    height: 124,\r\n                    margin: 0\r\n                }, function (error) {\r\n                    if (error) {\r\n                        // console.error(error)\r\n                    } else {\r\n                        that.codeImgUrl = canvas.toDataURL('image/png')\r\n                    }\r\n                })\r\n        },\r\n        saveCodeImg() {\r\n            let myCanvas = document.getElementsByTagName('canvas');\r\n            this.imgUrl = myCanvas[0].toDataURL('image/png')\r\n            this.getUrlBase64(this.imgUrl).then(base64 => {\r\n                let link = document.createElement('a')\r\n                link.href = base64\r\n                link.download = 'qrCode.png'\r\n                link.click()\r\n            })\r\n        },\r\n        getUrlBase64(url) {\r\n            return new Promise(resolve => {\r\n                let canvas = document.createElement('canvas')\r\n                let ctx = canvas.getContext('2d')\r\n                let img = new Image()\r\n                img.crossOrigin = 'Anonymous' //允许跨域\r\n                img.src = url\r\n                img.onload = function () {\r\n                    canvas.height = 300\r\n                    canvas.width = 300\r\n                    ctx.drawImage(img, 0, 0, 300, 300)\r\n                    let dataURL = canvas.toDataURL('image/png')\r\n                    canvas = null\r\n                    resolve(dataURL)\r\n                }\r\n            })\r\n        },\r\n        getImgUrlHandle(path) {\r\n            console.log(`path ::->`, path);\r\n            return getImgUrl(path)\r\n        },\r\n        toPay(path) {\r\n            window.open(path)\r\n        }\r\n    }\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.pay_btn {\r\n    margin-top: 40px;\r\n    background: var(--main-color);\r\n}\r\n\r\n.page-content {\r\n    width: 100%;\r\n    min-height: 100%;\r\n    background: #F5F5F7;\r\n\r\n    * {\r\n        box-sizing: border-box;\r\n    }\r\n\r\n    .info-content {\r\n        padding: 10px 15px;\r\n\r\n        .order-info-content {\r\n            padding: 0 10px;\r\n            background-color: #fff;\r\n\r\n            >.item {\r\n                padding: 17px 0;\r\n                border-bottom: 1px solid #eee;\r\n                color: #000;\r\n                font-size: 14px;\r\n                display: flex;\r\n                justify-content: space-between;\r\n\r\n                &.center {\r\n                    align-items: center;\r\n                }\r\n\r\n                >div {\r\n                    flex: 1;\r\n                    padding-left: 50px;\r\n                    text-align: end;\r\n\r\n                    &.copy {\r\n                        display: flex;\r\n                        justify-content: flex-end;\r\n\r\n                        >span {\r\n                            text-align: start;\r\n                            flex: 1;\r\n                            word-break: break-word;\r\n                        }\r\n\r\n                        >img {\r\n                            width: 10px;\r\n                            height: 10px;\r\n                            margin-left: 4px;\r\n                            position: relative;\r\n                            top: 3px;\r\n                        }\r\n                    }\r\n\r\n                    &.money {\r\n\r\n                        color: var(--main-color);\r\n                    }\r\n\r\n                    &.success {\r\n                        color: #0ECB81 !important;\r\n                    }\r\n\r\n                    &.fail {\r\n                        color: #FF4141 !important;\r\n                    }\r\n\r\n                    .img-content {\r\n                        width: 62px;\r\n                        height: 56px;\r\n                        border-radius: 4px;\r\n                        background-color: #D9D9D9;\r\n                        overflow: hidden;\r\n                        display: flex;\r\n                        align-content: center;\r\n                        align-items: center;\r\n\r\n                        >img {\r\n                            width: 100%;\r\n                            height: auto;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                &.code-img {\r\n                    flex-direction: column;\r\n                    align-items: center;\r\n\r\n                    >div {\r\n                        padding: 0;\r\n                        flex: 0;\r\n                        text-align: center;\r\n\r\n                        &.code-img-content {\r\n                            width: 138px;\r\n                            height: 138px;\r\n                            border: 1px solid #ddd;\r\n                            padding: 6px;\r\n                            display: flex;\r\n                            align-items: center;\r\n                            justify-content: center;\r\n\r\n                            >.canvas {\r\n                                width: 124px;\r\n                                height: 124px;\r\n                            }\r\n                        }\r\n\r\n                        &.btn {\r\n                            margin-top: 10px;\r\n\r\n                            >div {\r\n                                width: 105px;\r\n                                height: 36px;\r\n                                line-height: 34px;\r\n                                border: 1px solid #DDDDDD;\r\n                                border-radius: 4px;\r\n                                font-size: 12px;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                &.no-border,\r\n                &:last-child {\r\n                    border-bottom: none;\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}